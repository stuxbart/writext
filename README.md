# Writext
Writext is an online LaTeX source code editor that utilizes MiKTeX compilator to convert code into nice looking pdf files.

## Screens
![screen2](https://user-images.githubusercontent.com/54537352/203807516-cdd1f363-7578-49a9-a0cb-8b9e3e38526d.png)
![screen1](https://user-images.githubusercontent.com/54537352/203807531-30a3ad25-9e7a-4360-9f8e-08c420cc88f6.png)

## Project stack
Backend of this project have been written in Python with usage of Django framework. Frontend of the project is written in Typescript and React framework.

## Project setup
First of all simply clone the repository:
```
git clone https://github.com/stuxbart/writext.git
```
Once you get repository, install all required python packages.
You can start with creating new python environment by runing command:
```
python -m venv venv
```
Activate the environment:
```
venv\Scripts\activate
```
Install latest version of pip:
```
python -m pip install --upgrade pip
```
ant then install packages required for project:
```
pip install -r writext/requirements.txt
```
Go to writext folder and try to run server:
```
python manage.py runserver
```
If you see message about missing staticfiles folders and following communicate:
```
Watching for file changes with StatReloader
Performing system checks...

System check identified no issues (0 silenced).
November 24, 2022 - 13:16:18
Django version 4.0.6, using settings 'writext.settings'
Starting ASGI/Channels version 3.0.5 development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
```
then everything works fine so far.
If you see error related to python magic package or your command line freeze at:
```
Watching for file changes with StatReloader
Performing system checks...
```
you need to uninstall python magic package with:
```
pip uninstall python-magic
```
and install:
```
pip install python-magic-bin
```
for more info check https://github.com/ahupp/python-magic/issues/248.

Now if you can run server, it's time to setup database.
Writext expects PostgreSQL database running at `localhost:5432`. Database should have a user called `writext` with password `writext` with privileges 
to database with name `writext`.
For fast database setup you can execute following queries in your postgres cli:
```sql
CREATE DATABASE writext;
CREATE USER writext WITH PASSWORD 'writext';
GRANT ALL PRIVILEGES ON DATABASE writext TO writext;
```
When database is working correctly you can apply django migrations:
```
python manage.py migrate
```
it would create database schema for writext.
Next step is to create file containing environment variables, call it `.env` and put in base project folder (next to `manage.py` file).
For now file should contain only one variable:
```
SECRET_KEY=randomly_generated_key
```
You can generate your secret key using built in django function. To do it open django shell:
```
python manage.py shell
```
and run:
```
>>> from django.core.management import get_random_secret_key
>>> get_random_secret_key()
```
you should get a new secret key, copy it into `.env` file and save.

Now we are able to create admin account:
```
python manage.py createsuperuser
```
Django will ask you about username, email and password, since it is development environment it doesn't really matter how you will call this account. 
You should only remmember that writext uses email to authenticate users.

You can go to `localhost:8000/admin/` and log in into your account with email and password. After login you should see all database models that exists in the project.
If you will go to `localhost:8000` you will see `TemplateDoesNotExist` error, thats correct since dajngo looks for `frontend\build\index.html`
template generated by `npm run build`.
You can quickly fix it by going to `frontend` folder and executing following commands:
```
npm install
```
After installation of all necessery packages run:
```
npm run build
```
it will generate build folder where all required static files are stored.
Now you can back to `localhost:8000` and see correctly loaded page.
At this point you can create new projects, users and navigate over all pages but you can't compile a project and you can't edit project files.

Now its time to setup RabbitMQ and Redis. RabbitMQ is used as a message broker for Celery. A celery worker handle process of LaTeX code compilation.
Redis is used by Django Channels. 
Writext expects RabbitMQ to be available at `localhost:5672` and Redis at `localhost:6388`.
After setting up RabbitMQ you can run celery worker:
```
celery -A writext worker -l INFO -P eventlet
```
Back to `localhost:8000` and try to edit and compile your project, you should see a newly generated pdf file on the right side of editor. 
It you have installed LaTeX compilator in your system then it should be pdf file compiled with usage of it.
If not, the pdf file that appeard on the right side of editor is a blank page with some text at left bottom corner.
Project was tested with MiKTeX compilator (https://miktex.org/download).
